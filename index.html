<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>Global Chat</title>
<style>
body { font-family: sans-serif; background: #f5f5f5; margin:0; padding:0; direction: rtl;}
#topBar {background:#6200ea; color:white; text-align:center; padding:12px; font-size:18px;}
#messages {height:70vh; overflow-y:auto; padding:10px;}
.msg {background:white; padding:8px 12px; border-radius:10px; margin:6px 0; max-width:70%; box-shadow:0 0 4px rgba(0,0,0,0.2);}
.me {background:#d1eaff; margin-left:auto;}
.name {font-weight:bold; color:#333;}
.time {font-size:11px; color:gray; margin-top:4px;}
input, button {padding:10px; margin:5px 0; width:100%; box-sizing:border-box;}
button {background:#6200ea; color:white; border:none; border-radius:8px; cursor:pointer;}
</style>
</head>
<body>

<div id="topBar">ğŸŒ Global Chat</div>

<div id="messages"></div>

<div style="padding:10px;">
  <input id="name" placeholder="Ù†Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
  <input id="text" placeholder="Ù¾ÛŒØ§Ù…...">
  <button onclick="sendMessage()">Ø§Ø±Ø³Ø§Ù„</button>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
  import { getDatabase, ref, push, onChildAdded, serverTimestamp } 
    from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";

  // ===== ØªÙ†Ø¸ÛŒÙ…Ø§Øª Firebase =====
  const firebaseConfig = {
    apiKey: "AIzaSyARrlKYH7K4w8FNMKlxtftjOmxwWJTI8Ys",
    authDomain: "global-chat-ilia.firebaseapp.com",
    databaseURL: "https://global-chat-ilia-default-rtdb.firebaseio.com",
    projectId: "global-chat-ilia",
    storageBucket: "global-chat-ilia.appspot.com",
    messagingSenderId: "819528866312",
    appId: "1:819528866312:web:4844dd49b443b0559f4fbd"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const messagesRef = ref(db, "messages/");

  const chatBox = document.getElementById("messages");
  const nameInput = document.getElementById("name");
  const textInput = document.getElementById("text");

  // ===== Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ø²Ù†Ø¯Ù‡ =====
  onChildAdded(messagesRef, (snapshot) => {
    const data = snapshot.val();
    const div = document.createElement("div");
    div.className = "msg";
    if(data.name === nameInput.value) div.classList.add("me");
    div.innerHTML = `<div class="name">${data.name}</div><div>${data.msg}</div><div class="time">${new Date(data.time).toLocaleTimeString()}</div>`;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
  });

  // ===== Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… =====
  window.sendMessage = function() {
    const name = nameInput.value.trim();
    const msg = textInput.value.trim();
    if(!name){ alert("Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯"); return; }
    if(!msg) return;

    push(messagesRef, { name: name, msg: msg, time: Date.now() });
    textInput.value = "";
  };
</script>

</body>
</html>
